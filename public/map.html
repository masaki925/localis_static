<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title></title>
    <script src="http://maps.google.com/maps/api/js?sensor=true" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js"></script>

    <script src="https://cdn.jsdelivr.net/jquery.ui.map/3.0rc/min/jquery.ui.map.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.ui.map/3.0rc/jquery.ui.map.overlays.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.ui.map/3.0rc/jquery.ui.map.services.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.ui.map/3.0rc/jquery.ui.map.extensions.js"></script>

    <script src="http://cdn.aldu.net/google.maps.markerwithlabel/1.1.5/markerwithlabel.min.js"></script>

    <script type="text/javascript">
      $(function() {
        var arr = [];

        $.getJSON( '/d.json', function(data) { 
          $.each( data.markers, function(i, m) {
            arr.push( new google.maps.LatLng(m.latitude, m.longitude) );
          });
        });

        $('#map_canvas').gmap().bind('init', function(evt, map) { 
          $('#map_canvas').gmap('displayDirections', { 'origin': arr.pop(), 'destination': arr.pop(), 'travelMode': google.maps.DirectionsTravelMode.TRANSIT }, { 'panel': document.getElementById('panel') }, function(result, status) {
            console.debug(result);
          });
        });
      });

    </script>
  </head>
  <body>
    <div id="map_canvas" style="width:250px;height:250px"></div>
  </body>
</html>
